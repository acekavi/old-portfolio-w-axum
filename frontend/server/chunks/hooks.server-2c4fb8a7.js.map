{"version":3,"file":"hooks.server-2c4fb8a7.js","sources":["../../../.svelte-kit/output/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { A as API_URL } from \"./private.js\";\nimport { r as redirect } from \"./index.js\";\nconst handle = async ({ event, resolve }) => {\n  const session = event.cookies.get(\"session\");\n  const id = event.cookies.get(\"id\");\n  const current_url = event.url.pathname;\n  let options = {\n    method: \"GET\",\n    credentials: \"same-origin\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  };\n  if (session && id) {\n    options.headers = {\n      ...options.headers,\n      authorization: session.toString()\n    };\n    const response = await fetch(`${API_URL}/user/${event.cookies.get(\"id\")}`, options);\n    let currentUser = await response.json();\n    if (!response.ok) {\n      event.cookies.delete(\"session\");\n      event.cookies.delete(\"id\");\n    }\n    if (currentUser) {\n      event.locals.user = {\n        id: currentUser.id,\n        username: currentUser.username,\n        email: currentUser.email,\n        first_name: currentUser.first_name,\n        last_name: currentUser.last_name,\n        is_active: currentUser.is_active,\n        is_superuser: currentUser.is_superuser ? currentUser.is_superuser : false\n      };\n    }\n    if (current_url.includes(\"/admin\") && !currentUser.is_superuser) {\n      throw redirect(302, \"/user\");\n    }\n  } else {\n    if (current_url.includes(\"/user\") || current_url.includes(\"/admin\")) {\n      throw redirect(302, \"/\");\n    }\n  }\n  return resolve(event);\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;AAEK,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,MAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAC/C,EAAE,MAAM,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AACrC,EAAE,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC;AACzC,EAAE,IAAI,OAAO,GAAG;AAChB,IAAI,MAAM,EAAE,KAAK;AACjB,IAAI,WAAW,EAAE,aAAa;AAC9B,IAAI,OAAO,EAAE;AACb,MAAM,cAAc,EAAE,kBAAkB;AACxC,KAAK;AACL,GAAG,CAAC;AACJ,EAAE,IAAI,OAAO,IAAI,EAAE,EAAE;AACrB,IAAI,OAAO,CAAC,OAAO,GAAG;AACtB,MAAM,GAAG,OAAO,CAAC,OAAO;AACxB,MAAM,aAAa,EAAE,OAAO,CAAC,QAAQ,EAAE;AACvC,KAAK,CAAC;AACN,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;AACxF,IAAI,IAAI,WAAW,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;AAC5C,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AACtB,MAAM,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AACtC,MAAM,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACjC,KAAK;AACL,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG;AAC1B,QAAQ,EAAE,EAAE,WAAW,CAAC,EAAE;AAC1B,QAAQ,QAAQ,EAAE,WAAW,CAAC,QAAQ;AACtC,QAAQ,KAAK,EAAE,WAAW,CAAC,KAAK;AAChC,QAAQ,UAAU,EAAE,WAAW,CAAC,UAAU;AAC1C,QAAQ,SAAS,EAAE,WAAW,CAAC,SAAS;AACxC,QAAQ,SAAS,EAAE,WAAW,CAAC,SAAS;AACxC,QAAQ,YAAY,EAAE,WAAW,CAAC,YAAY,GAAG,WAAW,CAAC,YAAY,GAAG,KAAK;AACjF,OAAO,CAAC;AACR,KAAK;AACL,IAAI,IAAI,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,EAAE;AACrE,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;AACnC,KAAK;AACL,GAAG,MAAM;AACT,IAAI,IAAI,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACzE,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC/B,KAAK;AACL,GAAG;AACH,EAAE,OAAO,OAAO,CAAC,KAAK,CAAC,CAAC;AACxB;;;;"}