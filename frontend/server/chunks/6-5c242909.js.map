{"version":3,"file":"6-5c242909.js","sources":["../../../.svelte-kit/output/adapter-node/entries/pages/auth/_page.server.ts.js","../../../.svelte-kit/output/adapter-node/nodes/6.js"],"sourcesContent":["import { A as API_URL } from \"../../../chunks/private.js\";\nimport { r as redirect, f as fail } from \"../../../chunks/index.js\";\nconst load = async ({ parent }) => {\n  const { user } = await parent();\n  if (user) {\n    throw redirect(302, \"/blog\");\n  }\n};\nconst actions = {\n  login: async ({ cookies, request }) => {\n    const data = await request.formData();\n    const username = String(data.get(\"username\"));\n    const password = String(data.get(\"password\"));\n    const loginPayload = { username, password };\n    const response = await fetch(`${API_URL}/user/login`, {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(loginPayload)\n    });\n    const json = await response.json();\n    if (!response.ok) {\n      if (json.error) {\n        return fail(422, {\n          username: data.get(\"username\"),\n          password: data.get(\"password\"),\n          error: json.error\n        });\n      }\n    }\n    if (response.headers.get(\"authorization\") !== null) {\n      let jwt_token = response.headers.get(\"authorization\") ?? \"\";\n      cookies.set(\"session\", jwt_token, {\n        httpOnly: true,\n        sameSite: \"strict\",\n        secure: true,\n        maxAge: 60 * 60 * 8,\n        path: \"/\"\n      });\n      cookies.set(\"id\", json.id, { httpOnly: true, sameSite: \"strict\", secure: true, maxAge: 60 * 60 * 8, path: \"/\" });\n      return { message: \"Successfully logged in!\" };\n    }\n  },\n  register: async ({ cookies, request }) => {\n    const data = await request.formData();\n    const username = String(data.get(\"username\"));\n    const email = String(data.get(\"email\"));\n    const password = String(data.get(\"password\"));\n    const confirm_password = String(data.get(\"confirm-password\"));\n    if (password !== confirm_password) {\n      return fail(422, {\n        username,\n        email,\n        password,\n        confirm_password,\n        error: \"Passwords do not match\"\n      });\n    }\n    const registerPayload = { username, email, password };\n    const response = await fetch(`${API_URL}/user/register`, {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(registerPayload)\n    });\n    const json = await response.json();\n    if (!response.ok) {\n      if (json.error) {\n        return fail(422, {\n          username,\n          email,\n          password,\n          confirm_password,\n          error: json.error\n        });\n      }\n    }\n    if (response.headers.get(\"authorization\") !== null) {\n      let jwt_token = response.headers.get(\"authorization\") ?? \"\";\n      cookies.set(\"session\", jwt_token, {\n        httpOnly: true,\n        sameSite: \"strict\",\n        secure: true,\n        maxAge: 60 * 60 * 8,\n        path: \"/\"\n      });\n      cookies.set(\"id\", json.id, { httpOnly: true, sameSite: \"strict\", secure: true, maxAge: 60 * 60 * 8, path: \"/\" });\n      return { message: \"Successfully signed up!\" };\n    }\n  },\n  logout: async ({ cookies, request }) => {\n    await request.formData();\n    const session = cookies.get(\"session\");\n    let options = {\n      method: \"GET\",\n      credentials: \"same-origin\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    if (session) {\n      options.headers = {\n        ...options.headers,\n        authorization: session\n      };\n    }\n    const response = await fetch(`${API_URL}/user/logout`, options);\n    const json = await response.json();\n    if (!response.ok) {\n      if (json.error) {\n        return fail(422, {\n          error: json.error\n        });\n      }\n    } else {\n      cookies.delete(\"session\");\n      cookies.delete(\"id\");\n      return { message: \"Successfully logged out!\" };\n    }\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/auth/_page.server.ts.js';\n\nexport const index = 6;\nexport { server };\nexport const server_id = \"src/routes/auth/+page.server.ts\";\nexport const imports = [];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}